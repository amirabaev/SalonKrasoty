import telebot
from telebot import types
import re
from datetime import datetime

# ================ –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï –°–Æ–î–ê ================
TOKEN = '8086852567:AAH77qUsDbu7RgwxVAHEDBOxMVAP2bLiBKg'  # –°–Æ–î–ê –¢–û–ö–ï–ù –û–¢ BOTFATHER
ADMIN_CHAT_ID = '6627729254'  # –°–Æ–î–ê –¢–í–û–ô ID –û–¢ USERINFOBOT
# ========================================================

bot = telebot.TeleBot(TOKEN)
user_data = {}

# ------------------------------------------------------------
# –§–£–ù–ö–¶–ò–ò –°–û–ó–î–ê–ù–ò–Ø –ö–õ–ê–í–ò–ê–¢–£–† (–ö–ù–û–ü–û–ö)
# ------------------------------------------------------------

def main_keyboard():
    """
    –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ - –ø–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ /start –∏ –∫–æ–≥–¥–∞ –Ω–∞–∂–∏–º–∞–µ–º "–ù–∞–∑–∞–¥"
    """
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
    buttons = [
        "üíá‚Äç‚ôÄÔ∏è –£—Å–ª—É–≥–∏", 
        "üí∞ –¶–µ–Ω—ã", 
        "üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è", 
        "üìç –ö–æ–Ω—Ç–∞–∫—Ç—ã"
    ]
    keyboard.add(*buttons)
    return keyboard

def back_keyboard():
    """
    –ö–õ–ê–í–ò–ê–¢–£–†–ê –° –ö–ù–û–ü–ö–û–ô –ù–ê–ó–ê–î - –¥–ª—è –ø–æ–¥–º–µ–Ω—é
    """
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.add("üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    return keyboard

def back_and_phone_keyboard():
    """
    –ö–õ–ê–í–ò–ê–¢–£–†–ê –î–õ–Ø –ó–ê–ü–ò–°–ò - –∫–Ω–æ–ø–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    """
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    phone_button = types.KeyboardButton("üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞", request_contact=True)
    back_button = types.KeyboardButton("üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    keyboard.add(phone_button)
    keyboard.add(back_button)
    return keyboard

def back_button_only():
    """
    –ü–†–û–°–¢–û –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î - –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ —Å –≤–≤–æ–¥–æ–º —Ç–µ–∫—Å—Ç–∞
    """
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    keyboard.add("üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    return keyboard

# ------------------------------------------------------------
# –§–£–ù–ö–¶–ò–Ø –ü–†–û–í–ï–†–ö–ò –ò –í–û–ó–í–†–ê–¢–ê –í –ú–ï–ù–Æ
# ------------------------------------------------------------

def check_back_button(message):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞–∂–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –µ—Å–ª–∏ –Ω–∞–∂–∞–ª
    """
    if message.text == "üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é":
        # –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –æ–Ω –±—ã–ª –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∑–∞–ø–∏—Å–∏
        if message.chat.id in user_data:
            del user_data[message.chat.id]
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
        bot.send_message(
            message.chat.id, 
            "üè† –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
            reply_markup=main_keyboard()
        )
        return True
    return False

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–û–ú–ê–ù–î–´ /start
# ------------------------------------------------------------

@bot.message_handler(commands=['start'])
def send_welcome(message):
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    user_name = message.from_user.first_name
    
    # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    if message.chat.id in user_data:
        del user_data[message.chat.id]
    
    welcome_text = f"""
üåü –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∞–ª–æ–Ω –∫—Ä–∞—Å–æ—Ç—ã, {user_name}!

–Ø –ø–æ–º–æ–≥—É –≤–∞–º:
‚Ä¢ –û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å —É—Å–ª—É–≥–∞–º–∏ –∏ —Ü–µ–Ω–∞–º–∏
‚Ä¢ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø—Ä–æ—Ü–µ–¥—É—Ä—É
‚Ä¢ –£–∑–Ω–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã –∏ –∞–¥—Ä–µ—Å

üëá –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π –ø—É–Ω–∫—Ç –≤ –º–µ–Ω—é:
    """
    bot.send_message(
        message.chat.id, 
        welcome_text, 
        reply_markup=main_keyboard()
    )

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–£–°–õ–£–ì–ò"
# ------------------------------------------------------------

@bot.message_handler(func=lambda message: message.text == "üíá‚Äç‚ôÄÔ∏è –£—Å–ª—É–≥–∏")
def services(message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —É—Å–ª—É–≥ —Å –∫–Ω–æ–ø–∫–æ–π –ù–ê–ó–ê–î"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞–∂–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å "–ù–∞–∑–∞–¥" (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    if check_back_button(message):
        return
    
    text = """
üíá‚Äç‚ôÄÔ∏è *–ù–ê–®–ò –£–°–õ–£–ì–ò:*

üíÜ‚Äç‚ôÄÔ∏è *–í–û–õ–û–°–´:*
‚Ä¢ –ñ–µ–Ω—Å–∫–∏–µ —Å—Ç—Ä–∏–∂–∫–∏
‚Ä¢ –ú—É–∂—Å–∫–∏–µ —Å—Ç—Ä–∏–∂–∫–∏
‚Ä¢ –û–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ
‚Ä¢ –õ–∞–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚Ä¢ –õ–µ—á–µ–Ω–∏–µ –≤–æ–ª–æ—Å

üíÖ *–ù–û–ì–¢–ò:*
‚Ä¢ –ú–∞–Ω–∏–∫—é—Ä
‚Ä¢ –ü–µ–¥–∏–∫—é—Ä
‚Ä¢ –ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ
‚Ä¢ –î–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π

‚ú® *–ö–û–°–ú–ï–¢–û–õ–û–ì–ò–Ø:*
‚Ä¢ –ß–∏—Å—Ç–∫–∞ –ª–∏—Ü–∞
‚Ä¢ –ú–∞—Å—Å–∞–∂
‚Ä¢ –£—Ö–æ–¥–æ–≤—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã

üíÑ *–í–ò–ó–ê–ñ:*
‚Ä¢ –î–Ω–µ–≤–Ω–æ–π –º–∞–∫–∏—è–∂
‚Ä¢ –í–µ—á–µ—Ä–Ω–∏–π –º–∞–∫–∏—è–∂
‚Ä¢ –°–≤–∞–¥–µ–±–Ω—ã–π –º–∞–∫–∏—è–∂

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ü–µ–Ω –Ω–∞–∂–º–∏—Ç–µ "üí∞ –¶–µ–Ω—ã"
    """
    bot.send_message(
        message.chat.id, 
        text, 
        parse_mode='Markdown',
        reply_markup=back_keyboard()  # –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î –ï–°–¢–¨!
    )

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–¶–ï–ù–´"
# ------------------------------------------------------------

@bot.message_handler(func=lambda message: message.text == "üí∞ –¶–µ–Ω—ã")
def prices(message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–µ–Ω—ã —Å –∫–Ω–æ–ø–∫–æ–π –ù–ê–ó–ê–î"""
    
    if check_back_button(message):
        return
    
    text = """
üí∞ *–ü–†–ê–ô–°-–õ–ò–°–¢:*

üíá‚Äç‚ôÄÔ∏è *–°–¢–†–ò–ñ–ö–ò:*
‚Ä¢ –ñ–µ–Ω—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞ - 1500 ‚ÇΩ
‚Ä¢ –ú—É–∂—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞ - 1000 ‚ÇΩ
‚Ä¢ –î–µ—Ç—Å–∫–∞—è —Å—Ç—Ä–∏–∂–∫–∞ - 800 ‚ÇΩ
‚Ä¢ –£–∫–ª–∞–¥–∫–∞ - 1000 ‚ÇΩ

üé® *–û–ö–†–ê–®–ò–í–ê–ù–ò–ï:*
‚Ä¢ –¢–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Ç 2000 ‚ÇΩ
‚Ä¢ –ü–æ–ª–Ω–æ–µ –æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ - –æ—Ç 3500 ‚ÇΩ
‚Ä¢ –ú–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ - –æ—Ç 4000 ‚ÇΩ
‚Ä¢ –û–º–±—Ä–µ/—à–∞—Ç—É—à - –æ—Ç 5000 ‚ÇΩ

üíÖ *–ú–ê–ù–ò–ö–Æ–†:*
‚Ä¢ –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π - 1500 ‚ÇΩ
‚Ä¢ –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–π - 1700 ‚ÇΩ
‚Ä¢ –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π - 1800 ‚ÇΩ
‚Ä¢ –ü–æ–∫—Ä—ã—Ç–∏–µ –≥–µ–ª—å-–ª–∞–∫ - +1000 ‚ÇΩ

üíÜ‚Äç‚ôÄÔ∏è *–ö–û–°–ú–ï–¢–û–õ–û–ì–ò–Ø:*
‚Ä¢ –ß–∏—Å—Ç–∫–∞ –ª–∏—Ü–∞ - 2500 ‚ÇΩ
‚Ä¢ –ú–∞—Å—Å–∞–∂ –ª–∏—Ü–∞ - 1500 ‚ÇΩ
‚Ä¢ –ú–∞—Å–∫–∞ –¥–ª—è –ª–∏—Ü–∞ - 1200 ‚ÇΩ

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ÄºÔ∏è –¢–æ—á–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
üìù –î–ª—è –∑–∞–ø–∏—Å–∏ –Ω–∞–∂–º–∏—Ç–µ "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
    """
    bot.send_message(
        message.chat.id, 
        text, 
        parse_mode='Markdown',
        reply_markup=back_keyboard()  # –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î –ï–°–¢–¨!
    )

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–ö–û–ù–¢–ê–ö–¢–´"
# ------------------------------------------------------------

@bot.message_handler(func=lambda message: message.text == "üìç –ö–æ–Ω—Ç–∞–∫—Ç—ã")
def contacts(message):
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å –∫–Ω–æ–ø–∫–æ–π –ù–ê–ó–ê–î"""
    
    if check_back_button(message):
        return
    
    text = """
üìç *–ö–ê–ö –ù–ê–° –ù–ê–ô–¢–ò:*

üè¢ *–ê–î–†–ï–°:*
–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –¢–≤–µ—Ä—Å–∫–∞—è, –¥. 15
–¢–¶ "–ì–∞–ª–µ—Ä–µ—è", 3 —ç—Ç–∞–∂

‚è∞ *–†–ï–ñ–ò–ú –†–ê–ë–û–¢–´:*
–ü–Ω-–ü—Ç: 10:00 - 21:00
–°–±-–í—Å: 11:00 - 20:00

üìû *–¢–ï–õ–ï–§–û–ù–´:*
+7 (999) 123-45-67
+7 (999) 765-43-21

üåê *–ú–´ –í –°–û–¶–°–ï–¢–Ø–•:*
Instagram: @salon_krasoty
VK: vk.com/salon_krasoty
Telegram: @salon_krasoty_bot

üöó *–ö–ê–ö –î–û–ï–•–ê–¢–¨:*
–ú–µ—Ç—Ä–æ "–¢–≤–µ—Ä—Å–∫–∞—è", –≤—ã—Ö–æ–¥ ‚Ññ3
–î–∞–ª–µ–µ 5 –º–∏–Ω—É—Ç –ø–µ—à–∫–æ–º

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí´ –ñ–¥–µ–º –≤–∞—Å –≤ –≥–æ—Å—Ç–∏!
    """
    bot.send_message(
        message.chat.id, 
        text, 
        parse_mode='Markdown',
        reply_markup=back_keyboard()  # –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î –ï–°–¢–¨!
    )

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–ó–ê–ü–ò–°–ê–¢–¨–°–Ø"
# ------------------------------------------------------------

@bot.message_handler(func=lambda message: message.text == "üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è")
def start_booking(message):
    """–ù–∞—á–∏–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø–∏—Å–∏"""
    
    if check_back_button(message):
        return
    
    chat_id = message.chat.id
    
    # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user_data[chat_id] = {}
    
    text = """
üìù *–ó–ê–ü–ò–°–¨ –ù–ê –ü–†–û–¶–ï–î–£–†–£*

–î–ª—è –∑–∞–ø–∏—Å–∏ –º–Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è:
1Ô∏è‚É£ –í–∞—à–µ –∏–º—è
2Ô∏è‚É£ –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞

‚úèÔ∏è *–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à–µ –∏–º—è:*
    """
    bot.send_message(
        message.chat.id, 
        text, 
        parse_mode='Markdown',
        reply_markup=back_button_only()  # –¢–û–õ–¨–ö–û –ö–ù–û–ü–ö–ê –ù–ê–ó–ê–î
    )
    
    # –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ - –ø–æ–ª—É—á–∞–µ–º –∏–º—è
    bot.register_next_step_handler(message, get_name)

# ------------------------------------------------------------
# –ü–û–õ–£–ß–ï–ù–ò–ï –ò–ú–ï–ù–ò
# ------------------------------------------------------------

def get_name(message):
    """–ü–æ–ª—É—á–∞–µ—Ç –∏–º—è –∫–ª–∏–µ–Ω—Ç–∞"""
    chat_id = message.chat.id
    
    # –ü–†–û–í–ï–†–ö–ê: –Ω–µ –Ω–∞–∂–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ê–ó–ê–î
    if check_back_button(message):
        return
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∏–º—è –Ω–µ –ø—É—Å—Ç–æ–µ
    if message.text and message.text.strip():
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è
        user_data[chat_id]['name'] = message.text.strip()
        
        text = """
üìû *–£–ö–ê–ñ–ò–¢–ï –ù–û–ú–ï–† –¢–ï–õ–ï–§–û–ù–ê*

–í—ã –º–æ–∂–µ—Ç–µ:
‚úÖ –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üì± –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" 
   (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è - –±–æ—Ç –ø–æ–ª—É—á–∏—Ç —Ç–æ—á–Ω—ã–π –Ω–æ–º–µ—Ä)
‚úÖ –ò–ª–∏ –≤–≤–µ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é –≤ —Ñ–æ—Ä–º–∞—Ç–µ: +7 999 123-45-67

‚ö†Ô∏è –ù–æ–º–µ—Ä –Ω—É–∂–µ–Ω –¥–ª—è —Å–≤—è–∑–∏ —Å –≤–∞–º–∏
        """
        bot.send_message(
            message.chat.id, 
            text, 
            parse_mode='Markdown',
            reply_markup=back_and_phone_keyboard()  # –ö–ù–û–ü–ö–ê –¢–ï–õ–ï–§–û–ù–ê + –ù–ê–ó–ê–î
        )
        
        # –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ - –ø–æ–ª—É—á–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
        bot.register_next_step_handler(message, get_phone)
    else:
        # –ï—Å–ª–∏ –∏–º—è –ø—É—Å—Ç–æ–µ - –ø—Ä–æ—Å–∏–º —Å–Ω–æ–≤–∞
        bot.send_message(
            message.chat.id, 
            "‚ùå –ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:",
            reply_markup=back_button_only()
        )
        bot.register_next_step_handler(message, get_name)

# ------------------------------------------------------------
# –ü–û–õ–£–ß–ï–ù–ò–ï –¢–ï–õ–ï–§–û–ù–ê
# ------------------------------------------------------------

def get_phone(message):
    """–ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
    chat_id = message.chat.id
    
    # –ü–†–û–í–ï–†–ö–ê: –Ω–µ –Ω–∞–∂–∞–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ê–ó–ê–î
    if check_back_button(message):
        return
    
    # 1Ô∏è‚É£ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–∏–ª –∫–æ–Ω—Ç–∞–∫—Ç (–Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É)
    if message.contact:
        phone = message.contact.phone_number
        user_data[chat_id]['phone'] = phone
        send_booking_to_admin(chat_id)
    
    # 2Ô∏è‚É£ –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–µ–ª –Ω–æ–º–µ—Ä –≤—Ä—É—á–Ω—É—é
    elif message.text:
        # –û—á–∏—â–∞–µ–º –Ω–æ–º–µ—Ä –æ—Ç –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤ –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ +
        phone = re.sub(r'[^\d+]', '', message.text.strip())
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞
        if phone and (phone.startswith('+7') or phone.startswith('8') or phone.startswith('7')):
            if len(re.findall(r'\d', phone)) >= 10:
                # –ü—Ä–∏–≤–æ–¥–∏–º –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É +7...
                if phone.startswith('8'):
                    phone = '+7' + phone[1:]
                elif phone.startswith('7') and not phone.startswith('+7'):
                    phone = '+7' + phone[1:]
                
                user_data[chat_id]['phone'] = phone
                send_booking_to_admin(chat_id)
            else:
                bot.send_message(
                    chat_id, 
                    "‚ùå –ù–æ–º–µ—Ä —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π. –í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π –Ω–æ–º–µ—Ä:",
                    reply_markup=back_and_phone_keyboard()
                )
                bot.register_next_step_handler(message, get_phone)
        else:
            bot.send_message(
                chat_id, 
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: +7XXXXXXXXXX –∏–ª–∏ 8XXXXXXXXXX",
                reply_markup=back_and_phone_keyboard()
            )
            bot.register_next_step_handler(message, get_phone)
    else:
        # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª
        bot.send_message(
            chat_id, 
            "‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞:",
            reply_markup=back_and_phone_keyboard()
        )
        bot.register_next_step_handler(message, get_phone)

# ------------------------------------------------------------
# –û–¢–ü–†–ê–í–ö–ê –ó–ê–Ø–í–ö–ò –ê–î–ú–ò–ù–£
# ------------------------------------------------------------

def send_booking_to_admin(chat_id):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É –∞–¥–º–∏–Ω—É –∏ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞"""
    
    if chat_id in user_data:
        name = user_data[chat_id]['name']
        phone = user_data[chat_id]['phone']
        
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        try:
            user = bot.get_chat(chat_id)
            username = user.username or "–Ω–µ —É–∫–∞–∑–∞–Ω"
        except:
            username = "–Ω–µ —É–∫–∞–∑–∞–Ω"
        
        # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ê–î–ú–ò–ù–ê (–ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –ª–∏—á–∫—É)
        admin_message = f"""
üîî *–ù–û–í–ê–Ø –ó–ê–Ø–í–ö–ê –°–ê–õ–û–ù!*

üë§ *–ò–º—è:* {name}
üì± *–¢–µ–ª–µ—Ñ–æ–Ω:* `{phone}`
üÜî *Telegram ID:* {chat_id}
üë§ *Username:* @{username}
üìÖ *–î–∞—Ç–∞:* {datetime.now().strftime('%d.%m.%Y %H:%M')}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ –°–≤—è–∂–∏—Ç–µ—Å—å —Å –∫–ª–∏–µ–Ω—Ç–æ–º –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è
        """
        
        # –û–¢–ü–†–ê–í–ö–ê –ê–î–ú–ò–ù–£
        try:
            bot.send_message(ADMIN_CHAT_ID, admin_message, parse_mode='Markdown')
            admin_ok = True
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–¥–º–∏–Ω—É: {e}")
            admin_ok = False
        
        # –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ö–õ–ò–ï–ù–¢–ê (—Å–ø–∞—Å–∏–±–æ)
        thank_you_text = f"""
‚úÖ *–°–ø–∞—Å–∏–±–æ, {name}!*

üì® –í–∞—à–∞ –∑–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!

–ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ –Ω–æ–º–µ—Ä—É:
üìû `{phone}`

‚è± –û–±—ã—á–Ω–æ –º—ã –æ—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç
üí´ –•–æ—Ç–∏—Ç–µ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —á—Ç–æ-—Ç–æ –µ—â–µ?
        """
        
        bot.send_message(
            chat_id, 
            thank_you_text, 
            parse_mode='Markdown',
            reply_markup=main_keyboard()  # –í–û–ó–í–†–ê–©–ê–ï–ú –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ
        )
        
        # –ï—Å–ª–∏ –∞–¥–º–∏–Ω—É –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–æ—Å—å - —Å–æ–æ–±—â–∞–µ–º –∫–ª–∏–µ–Ω—Ç—É
        if not admin_ok:
            bot.send_message(
                chat_id,
                "‚ö†Ô∏è –í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ—Ç —Å–≤—è–∑–∏ —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º, –Ω–æ –≤–∞—à–∞ –∑–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ–∑–∂–µ."
            )
        
        # –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        del user_data[chat_id]

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–ù–ê–ó–ê–î" (–æ—Ç–¥–µ–ª—å–Ω–æ)
# ------------------------------------------------------------

@bot.message_handler(func=lambda message: message.text == "üîô –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
def back_to_main(message):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ –ù–ê–ó–ê–î –∏–∑ –ª—é–±–æ–≥–æ –º–µ—Å—Ç–∞"""
    
    # –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if message.chat.id in user_data:
        del user_data[message.chat.id]
    
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    bot.send_message(
        message.chat.id, 
        "üè† –í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é",
        reply_markup=main_keyboard()
    )

# ------------------------------------------------------------
# –û–ë–†–ê–ë–û–¢–ß–ò–ö –í–°–ï–• –û–°–¢–ê–õ–¨–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô
# ------------------------------------------------------------

@bot.message_handler(func=lambda message: True)
def handle_all_other_messages(message):
    """–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ"""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ—Ç —ç—Ç–æ "–ù–∞–∑–∞–¥"
    if check_back_button(message):
        return
    
    text = """
‚ùì –Ø –≤–∞—Å –Ω–µ –ø–æ–Ω–∏–º–∞—é üòä

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –ö–ù–û–ü–ö–ê–ú–ò –≤ –º–µ–Ω—é üëá
‚Ä¢ –î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ - –∫–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
‚Ä¢ –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ - –∫–Ω–æ–ø–∫–∞ "üîô –ù–∞–∑–∞–¥"
‚Ä¢ –î–ª—è –∑–∞–ø–∏—Å–∏ - –Ω–∞–∂–º–∏—Ç–µ "üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
    """
    bot.send_message(
        message.chat.id, 
        text,
        reply_markup=main_keyboard()
    )

# ------------------------------------------------------------
# –ó–ê–ü–£–°–ö –ë–û–¢–ê
# ------------------------------------------------------------

if __name__ == '__main__':
    print("=" * 50)
    print("‚úÖ –ë–û–¢ –°–ê–õ–û–ù–ê –ö–†–ê–°–û–¢–´ –ó–ê–ü–£–©–ï–ù!")
    print("=" * 50)
    print(f"ü§ñ –¢–æ–∫–µ–Ω: {TOKEN[:10]}...{TOKEN[-5:]}")
    print(f"üë§ Admin ID: {ADMIN_CHAT_ID}")
    print("üì± –ù–∞–ø–∏—à–∏—Ç–µ @your_bot_name –≤ Telegram")
    print("üî¥ –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ!")
    print("=" * 50)
    
    # –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
    while True:
        try:
            bot.polling(none_stop=True, interval=0, timeout=20)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...")
            import time
            time.sleep(5)
            print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é...")